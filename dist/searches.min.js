/***
  * ExplorerSearches - Explorer searches components.
  * @version v0.0.1-SNAPSHOT
  * @link http://www.ga.gov.au/
  * @license Copyright 2015 Geoscience Australia (http://www.ga.gov.au/copyright.html)
  */
!function(e,t){"use strict";e.module("exp.search.geosearch",["ngAutocomplete"]).directive("geoSearch",["$log","$q","$rootScope","googleService","searchMapService",function(e,t,n,a,r){var o=.1;return{templateUrl:"searches/geosearch/geosearch.html",controller:["$scope",function(t){t.values={from:{}},t.zoom=function(s){t.values.from.description&&a.getAddressDetails(t.values.from.description,t).then(function(a){function s(){r.goTo(p)}var i={type:"Feature",geometry:{type:"Point",coordinates:[a.lat,a.lon]},properties:{name:a.address}},c={from:"Google search",name:a.address,type:"GeoJSONPoint",pan:function(){s()},data:i},l=a.lon-o,u=a.lon+o,d=a.lat-o,h=a.lat+o,p={type:"Polygon",coordinates:[[[l,d],[l,h],[u,h],[u,d],[l,d]]]};return e.debug("Received the results for from"),t.values.from.results=a,a&&(s(),n.$broadcast("search.performed",c)),t.item="",a},function(t){e.debug("Failed to complete the from lookup.")})}}]}}]).factory("googleService",["$log","$q",function(e,n){var a,r=new t.maps.Geocoder;try{a=new t.maps.places.AutocompleteService(null,{types:["geocode"]})}catch(o){e.debug("Catching google error that manifests itself when debugging in Firefox only")}return{getAddressDetails:function(e,a){var o=n.defer();return r.geocode({address:e,region:"au"},function(e,n){n!=t.maps.GeocoderStatus.OK?a.$apply(function(){o.reject("Failed to find address")}):a.$apply(function(){o.resolve({lat:e[0].geometry.location.lat(),lon:e[0].geometry.location.lng(),address:e[0].formatted_address})})}),o.promise}}}])}(angular,google),function(e){"use strict";function t(){var e="service/basinsearch/basins",t="service/basinsearch/basin/",n="",a={};this.setReferenceUrl=function(t){e=t},this.setShapeUrl=function(e){t=e},this.setBaseUrl=function(e){n=e},this.$get=["$q","$rootScope","$timeout","httpData","searchMapService",function(r,o,s,i,c){var l={load:function(){return i.get(n+e,{cache:!0}).then(function(e){return a.basins=e.data.basins,a})},zoomToLocation:function(e){function a(){c.goTo(s)}var r=e.bbox,s={type:"Polygon",coordinates:[[[r.xMin,r.yMin],[r.xMin,r.yMax],[r.xMax,r.yMax],[r.xMax,r.yMin],[r.xMin,r.yMin]]]},i={from:"Basins search",type:"GeoJSONUrl",url:n+t+e.id,pan:a,show:!0,name:e.name,polygon:s};o.$broadcast("search.performed",i),a()}};return l}]}e.module("exp.search.basinsearch",["exp.search.map.service"]).directive("basinSearch",["$log","$timeout","basinService",function(e,t,n){return{restrict:"AE",transclude:!0,templateUrl:"searches/basinsearch/basinsearch.html",link:function(a,r){function o(){t.cancel(s),s=t(function(){e.info("Clear filter"),a.nameFilter=""},7e3)}var s;n.load().then(function(e){a.basinData=e}),a.changing=function(){e.info("Cancel close"),t.cancel(s)},a.cancel=o,a.zoomToLocation=function(e){n.zoomToLocation(e),o()}}}}]).provider("basinService",t).filter("basinFilterList",function(){return function(e,t,n){var a,r,o=[];return t?(n||(n=50),a=t.toLowerCase(),e&&(r=0,e.some(function(e){return e.name.toLowerCase().indexOf(a)>-1&&(o.push(e),r++),r>n})),o):o}})}(angular),function(e){"use strict";e.module("exp.search.lastsearch",[]).directive("expLastSearch",["$document","lastSearchService",function(e,t){return{restrict:"AE",transclude:!0,templateUrl:"searches/lastsearch/lastsearch.html",link:function(n,a){function r(e){27==e.which&&(e.stopPropagation(),e.preventDefault(),n.$apply(function(){n.close()}))}n.data=t.data(),e.on("keyup",r),n.toggle=function(){(n.data.search.displayed=!n.data.search.displayed)?t.show():t.hide()},n.pan=function(){n.data.search.pan()},n.close=function(){t.clear()}}}}]).provider("lastSearchService",[function(){var e=!0;this.noListen=function(){e=!1},this.$get=["$log","$rootScope","searchMapService",function(t,n,a){function r(t,n){o&&o.destroy(),o=a.getDrawer(n),e&&(s.search=n),n.show&&(n.displayed=!0,o.draw())}var o,s={search:null},i={show:function(){o.draw()},hide:function(){o&&o.erase()},data:function(){return s},isShowing:function(){o.isDrawn()},clear:function(){this.hide(),s.search=null}};return n.$on("search.performed",r),i}]}])}(angular),function(e){"use strict";function t(){var e="service/lgasearch/states",t="service/lgasearch/lgas",n="/explorer-cossap-services/service/lgasearch/lga/",a={};this.setReferenceUrl=function(e){t=e},this.setShapeUrl=function(e){n=e},this.$get=["$q","$rootScope","$timeout","httpData","searchMapService",function(r,o,s,i,c){var l={load:function(){return i.get(t,{cache:!0}).then(function(e){a.lgas=e.data.lgas}),i.get(e,{cache:!0}).then(function(e){a.states=e.data.states}),r.when(a)},zoomToLocation:function(e){function t(){c.goTo(r)}var a=e.bbox,r={type:"Polygon",coordinates:[[[a.xMin,a.yMin],[a.xMin,a.yMax],[a.xMax,a.yMax],[a.xMax,a.yMin],[a.xMin,a.yMin]]]},s={from:"LGA search",type:"GeoJSONUrl",url:n+e.id+"/geojson",pan:t,show:!0,name:e.name,polygon:r};e.id&&o.$broadcast("search.performed",s),t()}};return l}]}e.module("exp.search.lgasearch",[]).directive("lgaSearch",["$log","$timeout","lgaService",function(e,t,n){return{restrict:"AE",transclude:!0,templateUrl:"searches/lgasearch/lgasearch.html",link:function(a,r){function o(){t.cancel(s),s=t(function(){e.info("Clear filter"),a.nameFilter=""},7e3)}var s;n.load().then(function(e){a.lgaData=e}),a.changing=function(){e.info("Cancel close"),t.cancel(s)},a.cancel=o,a.zoomToLocation=function(e){n.zoomToLocation(e),o()}}}}]).provider("lgaService",t).filter("lgaFilterList",function(){return function(e,t,n){var a,r,o=[];return t?(n||(n=50),a=t.toLowerCase(),e&&(r=0,e.some(function(e){return e.name.toLowerCase().indexOf(a)>-1&&(o.push(e),r++),r>n})),o):o}})}(angular);var explorer;!function(e){var t;!function(e){"use strict";angular.module("exp.search.searches",["exp.search.lastsearch"]).directive("searchSearches",["searchService",function(e){return{restrict:"AE",replace:!0,transclude:!0,templateUrl:"searches/searches/searches.html",scope:{name:"@"},controller:["$scope",function(t){function n(n){t.state.searches.forEach(function(e){e.active=!1}),n.active=!0,t.name&&(e.getSearches()[t.name]=n)}t.state={showSearchButton:!0,searches:[]},t["switch"]=function(e){n(e)},this.add=function(e){console.log("Adding"),t.state.searches.push(e)},this.active=function(e){n(e)}}]}}]).directive("searchSearch",function(){return{template:"<div ng-transclude ng-show='active'></div>",transclude:!0,require:"^searchSearches",scope:{label:"@",key:"@",active:"=default"},link:function(e,t,n,a){a.add(e)}}}).factory("searchService",[function(){var e={},t={};return t.getSearches=function(){return e},t}])}(t=e.search||(e.search={}))}(explorer||(explorer={})),angular.module("exp.search.templates",[]).run(["$templateCache",function(e){e.put("searches/geosearch/geosearch.html",'<div class="btn-group pull-left radSearch" style="width:27em;opacity:0.9">\r\n	<div class="input-group">\r\n		<input type="text" ng-autocomplete ng-model="values.from.description" options=\'{country:"au"}\'\r\n					size="32" title="Select a locality to pan the map to." class="form-control" aria-label="...">\r\n		<div class="input-group-btn">\r\n			<button ng-click="zoom(false)" exp-ga="[\'send\', \'event\', \'radwaste\', \'click\', \'zoom to location\']"\r\n				class="btn btn-default"\r\n				title="Pan and potentially zoom to location."><i class="fa fa-search"></i></button>\r\n		</div>\r\n	</div>\r\n</div>'),e.put("searches/basinsearch/basinsearch.html",'<div class="btn-group pull-left radSearch" style="position:relative;width:27em;opacity:0.9">\r\n	<div class="input-group" style="width:100%;">\r\n		<input type="text" size="32" class="form-control" style="border-top-right-radius:4px;border-bottom-right-radius:4px;" \r\n				ng-keyup="keyup($event)" ng-focus="changing()" ng-model="nameFilter" placeholder="Find a basin of interest">\r\n		<div class="input-group-btn"></div>\r\n	</div>\r\n	<div style="width:26em; position:absolute;left:15px">	\r\n		<div class="row" ng-repeat="region in basinData.basins | basinFilterList : nameFilter : 10 | orderBy : \'name\'" \r\n				style="background-color:white;">\r\n			<div class="col-md-12 rw-sub-list-trigger">\r\n				<button class="undecorated zoomButton" ng-click="zoomToLocation(region);">{{region.name}}</button>\r\n			</div>	\r\n		</div>\r\n	</div>\r\n</div>'),e.put("searches/lastsearch/lastsearch.html",'<div style="padding:3px;padding-left:10px;position:relative" ng-class-even="\'even\'" ng-class-odd="\'active\'">\r\n	<div class="pull-left">\r\n			<div style="font-size:120%;padding-bottom:7px">Result from: {{data.search.from}}</div>\r\n			<div ng-if="data.search.type == \'GeoJSONPoint\'">\r\n				{{data.search.name}} (Lat {{data.search.data.geometry.coordinates[0] | number : 5}}&#176; Lng  {{data.search.data.geometry.coordinates[1] | number : 5}}&#176;)\r\n			</div>\r\n			<div ng-if="data.search.type == \'GeoJSONUrl\'">\r\n				{{data.search.name}} \r\n			</div>\r\n			<div class="pull-right">\r\n				<button class="undecorated" ng-click="dismiss()">\r\n					<i class="fa fa-cross"></i>\r\n				</button>\r\n			</div>\r\n	</div>\r\n	<div style="padding-left:10px" class="pull-right">\r\n		<button class="undecorated" class="featureLink" title="Show on map" \r\n			ng-click="toggle()"><i class="fa fa-lg" ng-class="{\'fa-eye-slash\':(!data.search.displayed), \'fa-eye\':data.search.displayed}"></i></button>\r\n		<button class="undecorated" class="featureLink" title="Pan map to region" \r\n			ng-click="pan()"><i class="fa fa-flag fa-lg"></i></button>							\r\n		<button class="undecorated" class="featureLink" title="Clear search/New search" \r\n			ng-click="close()"><i class="fa fa-close fa-lg"></i></button>							\r\n	</div>\r\n</div>\r\n'),e.put("searches/lgasearch/lgasearch.html",'<div class="btn-group pull-left radSearch" style="position:relative;width:27em;opacity:0.9">\r\n	<div class="input-group" style="width:100%;">\r\n		<input type="text" size="32" class="form-control" style="border-top-right-radius:4px;border-bottom-right-radius:4px;" \r\n				ng-keyup="keyup($event)" ng-focus="changing()" ng-model="nameFilter" placeholder="Find a state or local government area">\r\n		<div class="input-group-btn"></div>\r\n	</div>\r\n	<div style="width:26em; position:absolute;left:15px">	\r\n		<div class="lgaLists">\r\n			<div class="row stateList includeMe" ng-repeat="state in lgaData.states | lgaFilterList : nameFilter | orderBy : \'name\'" \r\n					style="background-color:white;">\r\n				<div class="col-md-12 ">\r\n					<button class="undecorated zoomButton" ng-click="zoomToLocation(state);">{{state.name}}</button>\r\n				</div>\r\n			</div>	\r\n		</div>\r\n		<div class="row" ng-repeat="region in lgaData.lgas | lgaFilterList : nameFilter : 10 | orderBy : \'name\'" \r\n				style="background-color:white;">\r\n			<div class="col-md-12 rw-sub-list-trigger">\r\n				<button class="undecorated zoomButton" ng-click="zoomToLocation(region);">{{region.name}}</button>\r\n			</div>	\r\n		</div>\r\n	</div>\r\n</div>'),e.put("searches/searches/searches.html",'<div class="searchesContainer">\r\n	<div ng-hide="data.search">\r\n		<span class="searchesItems" ng-transclude></span>\r\n		<span class="dropdown clearfix">\r\n			<div class="btn-group" role="group">\r\n				<div class="btn-group" role="group">\r\n					<button class="btn btn-default dropdown-toggle" type="button" id="searchesDropdownMenu3" \r\n							tooltip="Change search type" tooltip-append-to-body="true"\r\n							data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n		      			<i class="fa fa-align-justify"></i>\r\n   					</button>\r\n   					<ul class="dropdown-menu" aria-labelledby="searchesDropdownMenu3">\r\n	    	    		<li ng-repeat="search in state.searches"><button class="undecorated" ng-click="switch(search)" ng-class="{searchesStrong:search.active}">{{search.label}}</button></li>\r\n   					</ul>\r\n   				</div>\r\n   			</div>\r\n		</span>\r\n	</div>\r\n	<div class="searchesLastSearchContainer" exp-last-search ng-show="data.search"></div>\r\n</div>')}]);
//# sourceMappingURL=searches.min.js.map
