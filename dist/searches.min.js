/***
  * ExplorerSearches - Explorer searches components.
  * @version v0.0.1-SNAPSHOT
  * @link http://www.ga.gov.au/
  * @license Copyright 2015 Geoscience Australia (http://www.ga.gov.au/copyright.html)
  */
!function(t){"use strict";function e(){var t="service/basinsearch/basins",e="service/basinsearch/basin/",a="",n={};this.setReferenceUrl=function(e){t=e},this.setShapeUrl=function(t){e=t},this.setBaseUrl=function(t){a=t},this.$get=["$q","$rootScope","$timeout","httpData","searchMapService",function(r,o,s,i,c){var l={load:function(){return i.get(a+t,{cache:!0}).then(function(t){return n.basins=t.data.basins,n})},zoomToLocation:function(t){function n(){c.goTo(s)}var r=t.bbox,s={type:"Polygon",coordinates:[[[r.xMin,r.yMin],[r.xMin,r.yMax],[r.xMax,r.yMax],[r.xMax,r.yMin],[r.xMin,r.yMin]]]},i={from:"Basins search",type:"GeoJSONUrl",url:a+e+t.id,pan:n,show:!0,name:t.name,polygon:s};o.$broadcast("search.performed",i),n()}};return l}]}t.module("exp.search.basinsearch",["exp.search.map.service"]).directive("basinSearch",["$log","$timeout","basinService",function(t,e,a){return{restrict:"AE",transclude:!0,templateUrl:"searches/basinsearch/basinsearch.html",link:function(n,r){function o(){e.cancel(s),s=e(function(){t.info("Clear filter"),n.nameFilter=""},7e3)}var s;a.load().then(function(t){n.basinData=t}),n.changing=function(){t.info("Cancel close"),e.cancel(s)},n.cancel=o,n.zoomToLocation=function(t){a.zoomToLocation(t),o()}}}}]).provider("basinService",e).filter("basinFilterList",function(){return function(t,e,a){var n,r,o=[];return e?(a||(a=50),n=e.toLowerCase(),t&&(r=0,t.some(function(t){return t.name.toLowerCase().indexOf(n)>-1&&(o.push(t),r++),r>a})),o):o}})}(angular),function(t,e){"use strict";t.module("exp.search.geosearch",["ngAutocomplete"]).directive("geoSearch",["$log","$q","$rootScope","googleService","searchMapService",function(t,e,a,n,r){var o=.1;return{templateUrl:"searches/geosearch/geosearch.html",controller:["$scope",function(e){e.values={from:{}},e.zoom=function(s){e.values.from.description&&n.getAddressDetails(e.values.from.description,e).then(function(n){function s(){r.goTo(p)}var i={type:"Feature",geometry:{type:"Point",coordinates:[n.lat,n.lon]},properties:{name:n.address}},c={from:"Google search",name:n.address,type:"GeoJSONPoint",pan:function(){s()},data:i},l=n.lon-o,d=n.lon+o,u=n.lat-o,h=n.lat+o,p={type:"Polygon",coordinates:[[[l,u],[l,h],[d,h],[d,u],[l,u]]]};return t.debug("Received the results for from"),e.values.from.results=n,n&&(s(),a.$broadcast("search.performed",c)),e.item="",n},function(e){t.debug("Failed to complete the from lookup.")})}}]}}]).factory("googleService",["$log","$q",function(t,a){var n,r;try{n=new e.maps.Geocoder,r=new e.maps.places.AutocompleteService(null,{types:["geocode"]})}catch(o){t.debug("Catching google error that manifests itself when debugging in Firefox only")}return{getAddressDetails:function(t,r){var o=a.defer();return n.geocode({address:t,region:"au"},function(t,a){a!=e.maps.GeocoderStatus.OK?r.$apply(function(){o.reject("Failed to find address")}):r.$apply(function(){o.resolve({lat:t[0].geometry.location.lat(),lon:t[0].geometry.location.lng(),address:t[0].formatted_address})})}),o.promise}}}])}(angular,google),function(t){"use strict";t.module("exp.search.lastsearch",[]).directive("expLastSearch",["$document","lastSearchService","$rootScope",function(t,e,a){return{restrict:"AE",transclude:!0,templateUrl:"searches/lastsearch/lastsearch.html",link:function(n,r){function o(t){27==t.which&&(t.stopPropagation(),t.preventDefault(),n.$apply(function(){n.close()}))}n.data=e.data(),t.on("keyup",o),n.toggle=function(){(n.data.search.displayed=!n.data.search.displayed)?e.show():e.hide()},n.pan=function(){n.data.search.pan()},n.close=function(){a.$broadcast("search.cleared"),e.clear()}}}}]).provider("lastSearchService",[function(){var t=!0;this.noListen=function(){t=!1},this.$get=["$log","$rootScope","searchMapService",function(e,a,n){function r(e,a){o&&o.destroy(),o=n.getDrawer(a),t&&(s.search=a),a.show&&(a.displayed=!0,o.draw())}var o,s={search:null},i={show:function(){o.draw()},hide:function(){o&&o.erase()},data:function(){return s},isShowing:function(){o.isDrawn()},clear:function(){this.hide(),s.search=null}};return a.$on("search.performed",r),i}]}])}(angular),function(t){"use strict";function e(){var t="service/lgasearch/states",e="service/lgasearch/lgas",a="service/lgasearch/lga/",n={};this.setReferenceUrl=function(t){e=t},this.setShapeUrl=function(t){a=t},this.$get=["$q","$scope","$rootScope","$timeout","httpData","searchMapService",function(r,o,s,i,c,l){var d={load:function(){return c.get(e,{cache:!0}).then(function(t){n.lgas=t.data.lgas}),c.get(t,{cache:!0}).then(function(t){n.states=t.data.states}),r.when(n)},zoomToLocation:function(t){var e=new google.maps.Geocoder;e.geocode({address:t.name,region:"au"},function(e,n){function r(){l.goTo(u)}if(n!=google.maps.GeocoderStatus.OK)console.log("No result found");else{var o=e[0].geometry.location.lat(),i=e[0].geometry.location.lng(),c={type:"Feature",geometry:{type:"Point",coordinates:[o,i]},properties:{name:null}},d=t.bbox,u={type:"Polygon",coordinates:[[[d.xMin,d.yMin],[d.xMin,d.yMax],[d.xMax,d.yMax],[d.xMax,d.yMin],[d.xMin,d.yMin]]]},h={from:"LGA search",type:"GeoJSONUrl",url:a+t.id+"/geojson",pan:r,show:!0,name:t.name,polygon:u,data:c};t.id&&s.$broadcast("search.performed",h),r()}})}};return d}]}t.module("exp.search.lgasearch",[]).directive("lgaSearch",["$log","$timeout","lgaService",function(t,e,a){return{restrict:"AE",transclude:!0,templateUrl:"searches/lgasearch/lgasearch.html",link:function(n,r){function o(){e.cancel(s),s=e(function(){t.info("Clear filter"),n.nameFilter=""},7e3)}var s;a.load().then(function(t){n.lgaData=t}),n.changing=function(){t.info("Cancel close"),e.cancel(s)},n.cancel=o,n.zoomToLocation=function(t){a.zoomToLocation(t),o()}}}}]).provider("lgaService",e).filter("lgaFilterList",function(){return function(t,e,a){var n,r,o=[];return e?(a||(a=50),n=e.toLowerCase(),t&&(r=0,t.some(function(t){return t.name.toLowerCase().indexOf(n)>-1&&(o.push(t),r++),r>a})),o):o}})}(angular);var explorer;!function(t){var e;!function(t){"use strict";angular.module("exp.search.searches",["exp.search.lastsearch"]).directive("searchSearches",["searchService",function(t){return{restrict:"AE",replace:!0,transclude:!0,templateUrl:"searches/searches/searches.html",scope:{name:"@"},controller:["$scope",function(e){function a(a){e.state.searches.forEach(function(t){t.active=!1}),a.active=!0,e.name&&(t.getSearches()[e.name]=a)}e.state={showSearchButton:!0,searches:[]},e["switch"]=function(t){a(t)},this.add=function(t){console.log("Adding"),e.state.searches.push(t)},this.active=function(t){a(t)}}]}}]).directive("searchSearch",[function(){return{template:"<div ng-transclude ng-show='active'></div>",transclude:!0,require:"^searchSearches",scope:{label:"@",key:"@"},link:function(t,e,a,n){t.active=!!a["default"],n.add(t)}}}]).factory("searchService",[function(){var t={},e={};return e.getSearches=function(){return t},e}])}(e=t.search||(t.search={}))}(explorer||(explorer={})),angular.module("exp.search.templates",[]).run(["$templateCache",function(t){t.put("searches/basinsearch/basinsearch.html",'<div class="btn-group pull-left radSearch" style="position:relative;width:27em;opacity:0.9">\r\n\t<div class="input-group" style="width:100%;">\r\n\t\t<input type="text" size="32" class="form-control" style="border-top-right-radius:4px;border-bottom-right-radius:4px;" \r\n\t\t\t\tng-keyup="keyup($event)" ng-focus="changing()" ng-model="nameFilter" placeholder="Find a basin of interest">\r\n\t\t<div class="input-group-btn"></div>\r\n\t</div>\r\n\t<div style="width:26em; position:absolute;left:15px">\t\r\n\t\t<div class="row" ng-repeat="region in basinData.basins | basinFilterList : nameFilter : 10 | orderBy : \'name\'" \r\n\t\t\t\tstyle="background-color:white;">\r\n\t\t\t<div class="col-md-12 rw-sub-list-trigger">\r\n\t\t\t\t<button class="undecorated zoomButton" ng-click="zoomToLocation(region);">{{region.name}}</button>\r\n\t\t\t</div>\t\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("searches/geosearch/geosearch.html",'<div class="btn-group pull-left radSearch" style="width:27em;opacity:0.9">\r\n\t<div class="input-group">\r\n\t\t<input type="text" ng-autocomplete ng-model="values.from.description" options=\'{country:"au"}\'\r\n\t\t\t\t\tsize="32" title="Select a locality to pan the map to." class="form-control" aria-label="...">\r\n\t\t<div class="input-group-btn">\r\n\t\t\t<button ng-click="zoom(false)" exp-ga="[\'send\', \'event\', \'radwaste\', \'click\', \'zoom to location\']"\r\n\t\t\t\tclass="btn btn-default"\r\n\t\t\t\ttitle="Pan and potentially zoom to location."><i class="fa fa-search"></i></button>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("searches/lastsearch/lastsearch.html",'<div style="padding:3px;padding-left:10px;position:relative" ng-class-even="\'even\'" ng-class-odd="\'active\'">\r\n\t<div class="pull-left">\r\n\t\t\t<div style="font-size:120%;padding-bottom:7px">Result from: {{data.search.from}}</div>\r\n\t\t\t<div ng-if="data.search.type == \'GeoJSONPoint\'">\r\n\t\t\t\t{{data.search.name}} (Lat {{data.search.data.geometry.coordinates[0] | number : 5}}&#176; Lng  {{data.search.data.geometry.coordinates[1] | number : 5}}&#176;)\r\n\t\t\t</div>\r\n\t\t\t<div ng-if="data.search.type == \'GeoJSONUrl\'">\r\n\t\t\t\t{{data.search.name}} \r\n\t\t\t</div>\r\n\t\t\t<div class="pull-right">\r\n\t\t\t\t<button class="undecorated" ng-click="dismiss()">\r\n\t\t\t\t\t<i class="fa fa-cross"></i>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t</div>\r\n\t<div style="padding-left:10px" class="pull-right">\r\n\t\t<button class="undecorated" class="featureLink" title="Show on map" \r\n\t\t\tng-click="toggle()"><i class="fa fa-lg" ng-class="{\'fa-eye-slash\':(!data.search.displayed), \'fa-eye\':data.search.displayed}"></i></button>\r\n\t\t<button class="undecorated" class="featureLink" title="Pan map to region" \r\n\t\t\tng-click="pan()"><i class="fa fa-flag fa-lg"></i></button>\t\t\t\t\t\t\t\r\n\t\t<button class="undecorated" class="featureLink" title="Clear search/New search" \r\n\t\t\tng-click="close()"><i class="fa fa-close fa-lg"></i></button>\t\t\t\t\t\t\t\r\n\t</div>\r\n</div>\r\n'),t.put("searches/lgasearch/lgasearch.html",'<div class="btn-group pull-left radSearch" style="position:relative;width:27em;opacity:0.9">\r\n\t<div class="input-group" style="width:100%;">\r\n\t\t<input type="text" size="32" class="form-control" style="border-top-right-radius:4px;border-bottom-right-radius:4px;" \r\n\t\t\t\tng-keyup="keyup($event)" ng-focus="changing()" ng-model="nameFilter" placeholder="Find a state or local government area">\r\n\t\t<div class="input-group-btn"></div>\r\n\t</div>\r\n\t<div style="width:26em; position:absolute;left:15px">\t\r\n\t\t<div class="lgaLists">\r\n\t\t\t<div class="row stateList includeMe" ng-repeat="state in lgaData.states | lgaFilterList : nameFilter | orderBy : \'name\'" \r\n\t\t\t\t\tstyle="background-color:white;">\r\n\t\t\t\t<div class="col-md-12 ">\r\n\t\t\t\t\t<button class="undecorated zoomButton" ng-click="zoomToLocation(state);">{{state.name}}</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\t\r\n\t\t</div>\r\n\t\t<div class="row" ng-repeat="region in lgaData.lgas | lgaFilterList : nameFilter : 10 | orderBy : \'name\'" \r\n\t\t\t\tstyle="background-color:white;">\r\n\t\t\t<div class="col-md-12 rw-sub-list-trigger">\r\n\t\t\t\t<button class="undecorated zoomButton" ng-click="zoomToLocation(region);">{{region.name}}</button>\r\n\t\t\t</div>\t\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("searches/searches/searches.html",'<div class="searchesContainer">\r\n\t<div ng-hide="data.search">\r\n\t\t<span class="searchesItems" ng-transclude></span>\r\n\t\t<span class="dropdown clearfix">\r\n\t\t\t<div class="btn-group" role="group">\r\n\t\t\t\t<div class="btn-group" role="group">\r\n\t\t\t\t\t<button class="btn btn-default dropdown-toggle" type="button" id="searchesDropdownMenu3" \r\n\t\t\t\t\t\t\ttooltip="Change search type" tooltip-append-to-body="true"\r\n\t\t\t\t\t\t\tdata-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n\t\t      \t\t\t<i class="fa fa-align-justify"></i>\r\n   \t\t\t\t\t</button>\r\n   \t\t\t\t\t<ul class="dropdown-menu" aria-labelledby="searchesDropdownMenu3">\r\n\t    \t    \t\t<li ng-repeat="search in state.searches"><button class="undecorated" ng-click="switch(search)" ng-class="{searchesStrong:search.active}">{{search.label}}</button></li>\r\n   \t\t\t\t\t</ul>\r\n   \t\t\t\t</div>\r\n   \t\t\t</div>\r\n\t\t</span>\r\n\t</div>\r\n\t<div class="searchesLastSearchContainer" exp-last-search ng-show="data.search"></div>\r\n</div>')}]);
//# sourceMappingURL=searches.min.js.map
